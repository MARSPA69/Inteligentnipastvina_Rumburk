<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Komparativn√≠ anal√Ωza - Behavior√°ln√≠ monitoring krav | Rumburk</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary: #e94560;
            --bg-dark: #1a1a2e;
            --bg-medium: #16213e;
            --bg-light: #1f4068;
            --text-light: #e0e0e0;
            --text-muted: #aaa;
            --success: #2ecc71;
            --warning: #f1c40f;
            --danger: #e74c3c;
            --info: #3498db;
            /* Day colors */
            --day1: #e94560;
            --day2: #3498db;
            --day3: #2ecc71;
            --day4: #f39c12;
            --day5: #9b59b6;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-medium) 100%);
            color: var(--text-light);
            min-height: 100vh;
        }
        
        /* Header */
        .header {
            background: linear-gradient(90deg, #0f3460, var(--bg-medium));
            padding: 15px 20px;
            border-bottom: 3px solid var(--primary);
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
        }
        .header h1 { color: #fff; font-size: 1.5em; }
        .header .subtitle { color: var(--primary); font-size: 0.9em; margin-top: 3px; }
        .header-info {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }
        .header-badge {
            background: rgba(233, 69, 96, 0.2);
            border: 1px solid var(--primary);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }
        
        /* Buttons */
        .btn {
            appearance: none;
            border: 1px solid rgba(233, 69, 96, 0.45);
            background: rgba(0,0,0,0.25);
            color: #fff;
            padding: 10px 16px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        .btn:hover { background: rgba(0,0,0,0.4); transform: translateY(-1px); }
        .btn.primary { background: rgba(233, 69, 96, 0.3); }
        .btn.primary:hover { background: rgba(233, 69, 96, 0.5); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .btn-sm { padding: 6px 12px; font-size: 0.85em; }
        
        /* Container */
        .container { max-width: 1800px; margin: 0 auto; padding: 20px; }
        
        /* Wizard Overlay */
        .wizard-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(8px);
            display: grid;
            place-items: center;
            z-index: 10000;
            padding: 20px;
        }
        .wizard-overlay.hidden { display: none; }
        
        .wizard-card {
            background: linear-gradient(145deg, var(--bg-light), var(--bg-medium));
            border: 1px solid rgba(233, 69, 96, 0.4);
            border-radius: 20px;
            padding: 30px;
            width: min(600px, 100%);
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }
        .wizard-card h2 {
            color: #fff;
            font-size: 1.4em;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .wizard-card .step-indicator {
            background: var(--primary);
            color: #fff;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
        }
        .wizard-card p { color: var(--text-muted); margin-bottom: 20px; line-height: 1.5; }
        
        .wizard-input {
            width: 100%;
            padding: 14px 16px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.15);
            background: rgba(0,0,0,0.3);
            color: #fff;
            font-size: 1.1em;
            margin-bottom: 15px;
            text-align: center;
            letter-spacing: 2px;
        }
        .wizard-input::placeholder { color: rgba(255,255,255,0.4); letter-spacing: normal; }
        .wizard-input:focus { outline: none; border-color: var(--primary); }
        
        .wizard-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }
        .wizard-error {
            color: var(--danger);
            font-size: 0.9em;
            margin-top: -10px;
            margin-bottom: 15px;
        }
        
        /* Calendar */
        .calendar-container { margin: 20px 0; }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .calendar-header h3 { color: var(--primary); }
        .calendar-nav {
            display: flex;
            gap: 10px;
        }
        .calendar-nav button {
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            color: #fff;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2em;
        }
        .calendar-nav button:hover { background: rgba(0,0,0,0.5); }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }
        .calendar-day-header {
            text-align: center;
            padding: 8px;
            color: var(--text-muted);
            font-size: 0.85em;
            font-weight: 600;
        }
        .calendar-day {
            text-align: center;
            padding: 12px 8px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
            background: rgba(0,0,0,0.2);
        }
        .calendar-day:hover:not(.disabled):not(.selected) { 
            background: rgba(233, 69, 96, 0.2); 
        }
        .calendar-day.disabled {
            opacity: 0.3;
            cursor: not-allowed;
        }
        .calendar-day.selected {
            background: var(--primary);
            color: #fff;
            font-weight: bold;
        }
        .calendar-day.selected.day-1 { background: var(--day1); }
        .calendar-day.selected.day-2 { background: var(--day2); }
        .calendar-day.selected.day-3 { background: var(--day3); }
        .calendar-day.selected.day-4 { background: var(--day4); }
        .calendar-day.selected.day-5 { background: var(--day5); }
        .calendar-day.empty { background: transparent; cursor: default; }
        
        .selected-days {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
        }
        .selected-days h4 { color: var(--text-muted); font-size: 0.9em; margin-bottom: 10px; }
        .selected-days-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .selected-day-tag {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            color: #fff;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .selected-day-tag .remove {
            cursor: pointer;
            opacity: 0.7;
        }
        .selected-day-tag .remove:hover { opacity: 1; }
        .selected-day-tag.day-1 { background: var(--day1); }
        .selected-day-tag.day-2 { background: var(--day2); }
        .selected-day-tag.day-3 { background: var(--day3); }
        .selected-day-tag.day-4 { background: var(--day4); }
        .selected-day-tag.day-5 { background: var(--day5); }
        
        /* Loading */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.8);
            display: grid;
            place-items: center;
            z-index: 10001;
        }
        .loading-overlay.hidden { display: none; }
        .loading-spinner {
            text-align: center;
        }
        .loading-spinner .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.1);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Main Content */
        .main-content.hidden { display: none; }
        
        /* Stats Summary */
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        .summary-card {
            background: linear-gradient(145deg, var(--bg-light), var(--bg-medium));
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(233, 69, 96, 0.2);
        }
        .summary-card h3 {
            color: var(--primary);
            font-size: 1em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .summary-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        .summary-stat {
            text-align: center;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
        }
        .summary-stat .value {
            font-size: 1.4em;
            font-weight: bold;
            color: var(--primary);
        }
        .summary-stat .label {
            font-size: 0.75em;
            color: var(--text-muted);
            margin-top: 3px;
        }
        
        /* Comparison Grid */
        .comparison-section {
            margin-bottom: 25px;
        }
        .comparison-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }
        .comparison-header h2 {
            color: var(--primary);
            font-size: 1.3em;
        }
        .view-controls {
            display: flex;
            gap: 8px;
        }
        
        /* Day Cards */
        .days-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
            gap: 20px;
        }
        .day-card {
            background: linear-gradient(145deg, var(--bg-light), var(--bg-medium));
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        .day-card:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .day-card.day-1 { border-color: var(--day1); }
        .day-card.day-2 { border-color: var(--day2); }
        .day-card.day-3 { border-color: var(--day3); }
        .day-card.day-4 { border-color: var(--day4); }
        .day-card.day-5 { border-color: var(--day5); }
        
        .day-card-header {
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .day-card.day-1 .day-card-header { background: rgba(233, 69, 96, 0.2); }
        .day-card.day-2 .day-card-header { background: rgba(52, 152, 219, 0.2); }
        .day-card.day-3 .day-card-header { background: rgba(46, 204, 113, 0.2); }
        .day-card.day-4 .day-card-header { background: rgba(243, 156, 18, 0.2); }
        .day-card.day-5 .day-card-header { background: rgba(155, 89, 182, 0.2); }
        
        .day-card-header h3 {
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .day-card.day-1 .day-card-header h3 { color: var(--day1); }
        .day-card.day-2 .day-card-header h3 { color: var(--day2); }
        .day-card.day-3 .day-card-header h3 { color: var(--day3); }
        .day-card.day-4 .day-card-header h3 { color: var(--day4); }
        .day-card.day-5 .day-card-header h3 { color: var(--day5); }
        
        .day-card-body { padding: 15px 20px; }
        
        /* Day/Night Split */
        .day-night-split {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        .split-box {
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 12px;
            text-align: center;
        }
        .split-box.day-split { border-left: 3px solid #FFD700; }
        .split-box.night-split { border-left: 3px solid #4169E1; }
        .split-box .icon { font-size: 1.5em; margin-bottom: 5px; }
        .split-box .value { font-size: 1.3em; font-weight: bold; }
        .split-box.day-split .value { color: #FFD700; }
        .split-box.night-split .value { color: #4169E1; }
        .split-box .label { font-size: 0.75em; color: var(--text-muted); }
        
        /* Mini Stats */
        .mini-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }
        .mini-stat {
            text-align: center;
            padding: 10px;
            background: rgba(0,0,0,0.15);
            border-radius: 8px;
        }
        .mini-stat .value { font-size: 1.1em; font-weight: 600; color: var(--primary); }
        .mini-stat .label { font-size: 0.7em; color: var(--text-muted); margin-top: 2px; }
        
        /* Behavior Timeline Mini */
        .behavior-timeline-mini {
            display: flex;
            height: 30px;
            border-radius: 6px;
            overflow: hidden;
            margin-top: 10px;
        }
        .timeline-segment {
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.65em;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        .lying { background: linear-gradient(180deg, #4CAF50, #2E7D32); }
        .standing { background: linear-gradient(180deg, #FF9800, #F57C00); }
        .walking { background: linear-gradient(180deg, #2196F3, #1565C0); }
        
        /* Map Container */
        .map-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 20px;
        }
        .map-container {
            position: relative;
        }
        .compare-map-card {
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
            padding: 15px;
            position: relative;
        }
        .compare-map-card h4 {
            color: #fff;
            font-size: 1em;
            margin-bottom: 8px;
        }
        .map-wrapper {
            height: 440px;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
            position: relative;
        }
        .map-wrapper .leaflet-container { height: 100%; width: 100%; }
        .map-fullscreen-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.6);
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 6px 10px;
            cursor: pointer;
            z-index: 10;
        }
        .map-fullscreen-btn:hover { background: rgba(0,0,0,0.8); }
        .compare-map-card.fullscreen {
            position: fixed;
            inset: 20px;
            width: auto;
            height: auto;
            z-index: 10000;
            background: #0b1a2b;
            border: 2px solid var(--primary);
        }
        .compare-map-card.fullscreen .map-wrapper {
            height: calc(100vh - 150px);
        }
        .map-layer-select {
            position: absolute;
            top: 12px;
            left: 15px;
            display: none;
            gap: 6px;
            align-items: center;
            background: rgba(0,0,0,0.55);
            padding: 6px 10px;
            border-radius: 10px;
            color: #fff;
            z-index: 11;
        }
        .map-layer-select select {
            background: rgba(0,0,0,0.25);
            border: 1px solid rgba(233,69,96,0.35);
            color: #fff;
            border-radius: 8px;
            padding: 4px 8px;
        }
        .compare-map-card.fullscreen .map-layer-select {
            display: flex;
        }
        
        /* Collapsible Section */
        .collapsible-section {
            background: linear-gradient(145deg, var(--bg-light), var(--bg-medium));
            border-radius: 15px;
            margin-bottom: 20px;
            border: 1px solid rgba(233, 69, 96, 0.2);
            overflow: hidden;
        }
        .collapsible-header {
            padding: 18px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            background: rgba(0,0,0,0.1);
            transition: background 0.2s;
        }
        .collapsible-header:hover { background: rgba(0,0,0,0.2); }
        .collapsible-header h2 {
            color: var(--primary);
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .collapsible-header .toggle-icon {
            font-size: 1.2em;
            transition: transform 0.3s;
        }
        .collapsible-section.collapsed .collapsible-header .toggle-icon {
            transform: rotate(-90deg);
        }
        .collapsible-body {
            padding: 20px;
            border-top: 1px solid rgba(233, 69, 96, 0.2);
        }
        .collapsible-section.collapsed .collapsible-body { display: none; }
        
        /* Charts */
        .charts-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }
        .chart-box {
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
            padding: 20px;
        }
        .chart-box h4 {
            color: var(--text-light);
            font-size: 1em;
            margin-bottom: 15px;
        }
        .chart-wrapper { position: relative; height: 280px; }
        
        /* Legend */
        .legend {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        .legend-item { display: flex; align-items: center; gap: 8px; font-size: 0.9em; }
        .legend-color { width: 16px; height: 16px; border-radius: 4px; }
        
        /* Table */
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }
        .comparison-table th, .comparison-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .comparison-table th {
            background: rgba(233, 69, 96, 0.2);
            color: var(--primary);
            font-weight: 600;
        }
        .comparison-table th.day-1 { border-top: 3px solid var(--day1); }
        .comparison-table th.day-2 { border-top: 3px solid var(--day2); }
        .comparison-table th.day-3 { border-top: 3px solid var(--day3); }
        .comparison-table th.day-4 { border-top: 3px solid var(--day4); }
        .comparison-table th.day-5 { border-top: 3px solid var(--day5); }
        .comparison-table tr:hover { background: rgba(255,255,255,0.03); }
        .comparison-table .metric-name { text-align: left; color: var(--text-muted); }
        .comparison-table .highlight { color: var(--success); font-weight: 600; }
        .comparison-table .warning { color: var(--warning); }
        .comparison-table .danger { color: var(--danger); }
        
        /* Trend indicators */
        .trend-up { color: var(--success); }
        .trend-down { color: var(--danger); }
        .trend-stable { color: var(--text-muted); }

        /* Points layer legend */
        .points-legend {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(255,255,255,0.1);
            flex-wrap: wrap;
            justify-content: center;
        }
        .points-legend-title {
            color: var(--text-muted);
            font-size: 0.85em;
            margin-right: 5px;
        }
        .points-legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85em;
        }
        .points-legend-square {
            width: 12px;
            height: 12px;
            background: #6366f1;
        }
        .points-legend-triangle {
            width: 0;
            height: 0;
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
            border-bottom: 12px solid #fb923c;
        }

        /* Comparative timeline row */
        .timeline-comparison {
            display: flex;
            flex-direction: column;
            gap: 8px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            padding: 15px;
        }
        .timeline-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .timeline-label {
            min-width: 80px;
            font-size: 0.85em;
            color: var(--text-muted);
        }
        .timeline-bar {
            flex: 1;
            height: 20px;
            display: flex;
            background: rgba(255,255,255,0.05);
            border-radius: 4px;
            overflow: hidden;
        }
        .timeline-segment {
            height: 100%;
        }
        .timeline-segment.lying { background: #4CAF50; }
        .timeline-segment.standing { background: #FF9800; }
        .timeline-segment.walking { background: #2196F3; }

        /* Timeline axis */
        .timeline-axis {
            display: flex;
            justify-content: space-between;
            padding: 5px 90px 5px 90px;
            font-size: 0.7em;
            color: #666;
        }
        .timeline-axis span {
            position: relative;
        }
        .timeline-axis span::before {
            content: '';
            position: absolute;
            top: -5px;
            left: 50%;
            width: 1px;
            height: 4px;
            background: #555;
        }

        /* Cross-validation stats panel */
        .cross-val-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            background: rgba(0,0,0,0.15);
            border-radius: 8px;
            padding: 12px;
            margin-top: 10px;
        }
        .cross-val-stat {
            text-align: center;
        }
        .cross-val-stat .value {
            font-size: 1.3em;
            font-weight: 600;
            color: var(--primary);
        }
        .cross-val-stat .label {
            font-size: 0.75em;
            color: var(--text-muted);
        }

        /* Per-day vertical panels */
        .day-panels-vertical {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .day-panel {
            background: linear-gradient(145deg, var(--bg-light), var(--bg-medium));
            border-radius: 12px;
            border: 1px solid rgba(233, 69, 96, 0.2);
            overflow: hidden;
        }
        .day-panel-header {
            padding: 12px 15px;
            background: rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .day-panel-header .date {
            font-weight: 600;
            font-size: 1.1em;
        }
        .day-panel-body {
            padding: 15px;
        }
        .day-panel.day-1 { border-left: 4px solid var(--day1); }
        .day-panel.day-2 { border-left: 4px solid var(--day2); }
        .day-panel.day-3 { border-left: 4px solid var(--day3); }
        .day-panel.day-4 { border-left: 4px solid var(--day4); }
        .day-panel.day-5 { border-left: 4px solid var(--day5); }

        /* Statistics summary panel */
        .stats-summary {
            background: linear-gradient(145deg, rgba(233, 69, 96, 0.15), rgba(233, 69, 96, 0.05));
            border: 1px solid rgba(233, 69, 96, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .stats-summary h3 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }
        .stat-item {
            text-align: center;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
        }
        .stat-item .value { font-size: 1.4em; font-weight: 600; }
        .stat-item .label { font-size: 0.8em; color: var(--text-muted); margin-top: 4px; }
        .stat-item.trend-good .value { color: var(--success); }
        .stat-item.trend-warning .value { color: var(--warning); }
        .stat-item.trend-bad .value { color: var(--danger); }

        /* Central layer control for maps */
        .central-layer-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .central-layer-select {
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(233, 69, 96, 0.4);
            color: #fff;
            padding: 8px 14px;
            border-radius: 8px;
            font-size: 0.95em;
            cursor: pointer;
        }
        .central-layer-select:hover {
            background: rgba(0,0,0,0.5);
            border-color: var(--primary);
        }
        .central-layer-select:focus {
            outline: none;
            border-color: var(--primary);
        }
        .central-points-legend {
            padding: 12px 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
        }

        /* Maps Fullscreen Modal */
        .maps-fullscreen-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 20000;
            display: none;
            flex-direction: column;
        }
        .maps-fullscreen-overlay.active {
            display: flex;
        }
        .maps-fullscreen-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            background: linear-gradient(90deg, #0f3460, var(--bg-medium));
            border-bottom: 2px solid var(--primary);
        }
        .maps-fullscreen-header h3 {
            color: #fff;
            font-size: 1.1em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .maps-fullscreen-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .maps-fullscreen-controls label {
            color: var(--text-muted);
            font-size: 0.9em;
        }
        .maps-fullscreen-controls select {
            background: rgba(0,0,0,0.4);
            border: 1px solid rgba(233,69,96,0.5);
            color: #fff;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
        }
        .maps-fullscreen-close {
            background: rgba(233, 69, 96, 0.3);
            border: 1px solid var(--primary);
            color: #fff;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }
        .maps-fullscreen-close:hover {
            background: rgba(233, 69, 96, 0.5);
        }
        .maps-fullscreen-body {
            flex: 1;
            display: grid;
            gap: 8px;
            padding: 10px;
            overflow: hidden;
        }
        .maps-fullscreen-body.grid-2 {
            grid-template-columns: 1fr 1fr;
        }
        .maps-fullscreen-body.grid-4 {
            grid-template-columns: 1fr 1fr;
            grid-template-rows: 1fr 1fr;
        }
        .fullscreen-map-cell {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        .fullscreen-map-cell .cell-header {
            padding: 8px 12px;
            background: rgba(0,0,0,0.4);
            color: #fff;
            font-weight: 600;
            font-size: 0.95em;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .fullscreen-map-cell .cell-map {
            flex: 1;
            min-height: 0;
        }
        .fullscreen-map-cell .cell-map .leaflet-container {
            height: 100%;
            width: 100%;
        }

        /* Fullscreen button in maps section */
        .maps-section-fullscreen-btn {
            background: rgba(233, 69, 96, 0.25);
            border: 1px solid var(--primary);
            color: #fff;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .maps-section-fullscreen-btn:hover {
            background: rgba(233, 69, 96, 0.4);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header { flex-direction: column; text-align: center; }
            .days-grid { grid-template-columns: 1fr; }
            .day-night-split { grid-template-columns: 1fr; }
            .charts-row { grid-template-columns: 1fr; }
            .mini-stats { grid-template-columns: repeat(2, 1fr); }
        }
        
        /* Print */
        @media print {
            body { background: #fff; color: #111; }
            .header { background: #fff; border-bottom-color: #333; }
            .header h1, .header .subtitle { color: #111; }
            .wizard-overlay, .loading-overlay { display: none !important; }
            .btn { display: none; }
            .day-card, .collapsible-section, .summary-card, .chart-box {
                background: #fff;
                border: 1px solid #ddd;
                box-shadow: none;
            }
        }

        .cleaning-summary {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .cleaning-aggregate,
        .cleaning-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
            padding: 14px;
            border-radius: 12px;
            background: rgba(30, 30, 30, 0.5);
            border: 1px solid rgba(233, 69, 96, 0.2);
            flex-wrap: wrap;
        }
        .cleaning-dataset {
            flex: 1;
            min-width: 200px;
            font-weight: 600;
            color: #60a5fa;
        }
        .cleaning-stat {
            display: flex;
            flex-direction: column;
            min-width: 140px;
        }
        .cleaning-stat span,
        .cleaning-aggregate span {
            color: var(--text-muted);
            font-size: 0.85em;
            margin-bottom: 2px;
        }
        .cleaning-stat strong,
        .cleaning-aggregate strong {
            color: #fff;
            font-size: 1.2em;
        }
        .cleaning-empty {
            text-align: center;
            color: var(--text-muted);
            padding: 12px 0;
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <div id="loadingText">Naƒç√≠t√°m datasety...</div>
        </div>
    </div>
    
    <!-- Wizard Overlay -->
    <div id="wizardOverlay" class="wizard-overlay">
        <div class="wizard-card" id="step1Card">
            <h2><span class="step-indicator">1</span> Identifikace kr√°vy</h2>
            <p>Zadejte 6m√≠stn√© ID kr√°vy. Datasety mus√≠ b√Ωt ve form√°tu <strong>ID{XXXXXX}_{ddmmyy}.js</strong> ve stejn√© slo≈æce jako tento HTML soubor.</p>
            <input type="text" id="cowIdInput" class="wizard-input" placeholder="nap≈ô. 227831" maxlength="6" pattern="[0-9]{6}">

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                <div>
                    <label style="display: block; color: var(--text-muted); font-size: 0.85em; margin-bottom: 5px;">Datum posledn√≠ho porodu (voliteln√©)</label>
                    <input type="date" id="calvingDateInput" class="wizard-input" style="letter-spacing: normal; text-align: left; padding: 10px;">
                </div>
                <div>
                    <label style="display: block; color: var(--text-muted); font-size: 0.85em; margin-bottom: 5px;">Datum odchodu b√Ωka (voliteln√©)</label>
                    <input type="date" id="bullDateInput" class="wizard-input" style="letter-spacing: normal; text-align: left; padding: 10px;">
                    <div style="font-size: 0.75em; color: #888; margin-top: 3px;">Pro v√Ωpoƒçet pravdƒõpodobnosti b≈ôezosti</div>
                </div>
            </div>

            <div id="step1Error" class="wizard-error" style="display:none;"></div>
            <div class="wizard-actions">
                <button class="btn primary" id="step1Next">Pokraƒçovat ‚Üí</button>
            </div>
        </div>
        
        <div class="wizard-card" id="step2Card" style="display:none;">
            <h2><span class="step-indicator">2</span> V√Ωbƒõr dn≈Ø pro porovn√°n√≠</h2>
            <p>Vyberte a≈æ <strong>5 dn≈Ø</strong> z kalend√°≈ôe. Pro ka≈æd√Ω den bude naƒçten odpov√≠daj√≠c√≠ dataset.</p>
            
            <div class="calendar-container">
                <div class="calendar-header">
                    <h3 id="calendarMonth">Prosinec 2025</h3>
                    <div class="calendar-nav">
                        <button id="prevMonth">‚Äπ</button>
                        <button id="nextMonth">‚Ä∫</button>
                    </div>
                </div>
                <div class="calendar-grid" id="calendarGrid">
                    <!-- Generated by JS -->
                </div>
            </div>
            
            <div class="selected-days">
                <h4>Vybran√© dny (<span id="selectedCount">0</span>/5):</h4>
                <div class="selected-days-list" id="selectedDaysList">
                    <span style="color: var(--text-muted); font-size: 0.9em;">Zat√≠m nevybr√°n ≈æ√°dn√Ω den</span>
                </div>
            </div>
            
            <div id="step2Error" class="wizard-error" style="display:none;"></div>
            <div class="wizard-actions">
                <button class="btn" id="step2Back">‚Üê Zpƒõt</button>
                <button class="btn primary" id="step2Start" disabled>Spustit anal√Ωzu</button>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div id="mainContent" class="main-content hidden">
        <div class="header">
            <div>
                <h1>üêÑ Komparativn√≠ anal√Ωza kr√°vy ID <span id="headerCowId">------</span></h1>
                <div class="subtitle">Teltonika FMB920 | Behavior√°ln√≠ monitoring | Rumburk</div>
            </div>
            <div class="header-info">
                <div class="header-badge" id="headerDaysCount">üìä Porovn√°v√°no: 0 dn≈Ø</div>
                <button class="btn" id="changeSelectionBtn">Zmƒõnit v√Ωbƒõr</button>
                <button class="btn primary" id="exportBtn">Export PDF</button>
            </div>
        </div>
        
        <div class="container">
            <!-- Summary Section -->
            <div class="summary-grid" id="summaryGrid">
                <!-- Generated by JS -->
            </div>

            <!-- Statistical Summary Panel -->
            <div class="stats-summary" id="statsSummary">
                <h3>üìà Statistick√© vyhodnocen√≠ s√©rie</h3>
                <div class="stats-grid" id="statsGrid">
                    <!-- Generated by JS -->
                </div>
            </div>

            <!-- Comparative Timeline -->
            <div class="collapsible-section" id="timelineSection">
                <div class="collapsible-header" onclick="toggleSection('timelineSection')">
                    <h2>‚è±Ô∏è ƒåasov√° osa chov√°n√≠ (porovn√°n√≠)</h2>
                    <span class="toggle-icon">‚ñæ</span>
                </div>
                <div class="collapsible-body">
                    <div class="timeline-comparison" id="timelineComparison">
                        <!-- Generated by JS - one row per day -->
                    </div>
                    <div class="timeline-axis">
                        <span>00:00</span><span>04:00</span><span>08:00</span><span>12:00</span><span>16:00</span><span>20:00</span><span>24:00</span>
                    </div>
                    <div class="legend" style="margin-top: 10px;">
                        <div class="legend-item"><div class="legend-color" style="background: #4CAF50;"></div><span>Le≈æen√≠</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: #FF9800;"></div><span>St√°n√≠</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: #2196F3;"></div><span>Ch≈Øze</span></div>
                    </div>
                </div>
            </div>

            <!-- Days Comparison Cards -->
            <div class="comparison-section">
                <div class="comparison-header">
                    <h2>üìÖ Porovn√°n√≠ jednotliv√Ωch dn≈Ø</h2>
                    <div class="view-controls">
                        <button class="btn btn-sm" id="expandAllBtn">Rozbalit v≈°e</button>
                        <button class="btn btn-sm" id="collapseAllBtn">Sbalit v≈°e</button>
                    </div>
                </div>
                <div class="days-grid" id="daysGrid">
                    <!-- Generated by JS -->
                </div>
            </div>
            
            <!-- Comparison Table -->
            <div class="collapsible-section" id="tableSection">
                <div class="collapsible-header" onclick="toggleSection('tableSection')">
                    <h2>üìä Srovn√°vac√≠ tabulka metrik</h2>
                    <span class="toggle-icon">‚ñæ</span>
                </div>
                <div class="collapsible-body">
                    <div style="overflow-x: auto;">
                        <table class="comparison-table" id="comparisonTable">
                            <!-- Generated by JS -->
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Distance Comparison Chart -->
            <div class="collapsible-section" id="distanceSection">
                <div class="collapsible-header" onclick="toggleSection('distanceSection')">
                    <h2>üìè Porovn√°n√≠ vzd√°lenost√≠ (Den vs Noc)</h2>
                    <span class="toggle-icon">‚ñæ</span>
                </div>
                <div class="collapsible-body">
                    <div class="charts-row">
                        <div class="chart-box">
                            <h4>Celkov√° denn√≠ vzd√°lenost</h4>
                            <div class="chart-wrapper">
                                <canvas id="distanceCompareChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-box">
                            <h4>Rozdƒõlen√≠ Den / Noc</h4>
                            <div class="chart-wrapper">
                                <canvas id="dayNightChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Activity Comparison Chart -->
            <div class="collapsible-section" id="activitySection">
                <div class="collapsible-header" onclick="toggleSection('activitySection')">
                    <h2>‚è±Ô∏è Porovn√°n√≠ aktivit</h2>
                    <span class="toggle-icon">‚ñæ</span>
                </div>
                <div class="collapsible-body">
                    <div class="charts-row">
                        <div class="chart-box">
                            <h4>Rozlo≈æen√≠ chov√°n√≠ (hodiny)</h4>
                            <div class="chart-wrapper">
                                <canvas id="behaviorCompareChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-box">
                            <h4>Pr≈Ømƒõrn√° rychlost</h4>
                            <div class="chart-wrapper">
                                <canvas id="speedCompareChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="legend">
                        <div class="legend-item"><div class="legend-color" style="background: #4CAF50;"></div><span>Le≈æen√≠</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: #FF9800;"></div><span>St√°n√≠</span></div>
                        <div class="legend-item"><div class="legend-color" style="background: #2196F3;"></div><span>Ch≈Øze</span></div>
                    </div>
                </div>
            </div>
            
            <!-- RMS/Energy Comparison -->
            <div class="collapsible-section collapsed" id="energySection">
                <div class="collapsible-header" onclick="toggleSection('energySection')">
                    <h2>‚ö° Energetick√° n√°roƒçnost a RMS</h2>
                    <span class="toggle-icon">‚ñæ</span>
                </div>
                <div class="collapsible-body">
                    <div class="charts-row">
                        <div class="chart-box">
                            <h4>RMS dynamick√© akcelerace (pr≈Ømƒõr)</h4>
                            <div class="chart-wrapper">
                                <canvas id="rmsCompareChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-box">
                            <h4>Energetick√° n√°roƒçnost (relativn√≠)</h4>
                            <div class="chart-wrapper">
                                <canvas id="energyCompareChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Weather / Temperature Profiles -->
            <div class="collapsible-section" id="weatherSection">
                <div class="collapsible-header" onclick="toggleSection('weatherSection')">
                    <h2>üå°Ô∏è Teplotn√≠ profily a vlhkost (Open-Meteo)</h2>
                    <span class="toggle-icon">‚ñæ</span>
                </div>
                <div class="collapsible-body">
                    <div id="weatherSummaryCards" style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px;"></div>
                    <div class="charts-row">
                        <div class="chart-box">
                            <h4>Teplota v Rumburku (0:00 / 06:00 / 12:00 / 18:00)</h4>
                            <div class="chart-wrapper">
                                <canvas id="tempCompareChart"></canvas>
                            </div>
                        </div>
                        <div class="chart-box">
                            <h4>Relativn√≠ vlhkost vzduchu (%)</h4>
                            <div class="chart-wrapper">
                                <canvas id="humidityCompareChart"></canvas>
                            </div>
                        </div>
                    </div>
            </div>
        </div>

        <!-- Data Cleaning Summary -->
        <div class="collapsible-section" id="cleaningSection">
            <div class="collapsible-header" onclick="toggleSection('cleaningSection')">
                <h2>Data cleaning statistika</h2>
                <span class="toggle-icon">ÔøΩ-_</span>
            </div>
            <div class="collapsible-body">
                <div class="cleaning-summary" id="cleaningSummaryList">
                    <p class="cleaning-empty">Zatim zadna data.</p>
                </div>
            </div>
        </div>

        <!-- Maps Comparison (always visible, not collapsible) -->
        <div class="comparison-section" id="mapsSection">
                <div class="comparison-header">
                    <h2>üó∫Ô∏è Porovn√°n√≠ trajektori√≠ / heat map</h2>
                    <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                        <div class="central-layer-control">
                            <label style="color: var(--text-muted); margin-right: 8px;">Vrstva:</label>
                            <select id="centralLayerSelect" class="central-layer-select">
                                <option value="heat">Heat mapa</option>
                                <option value="trajectory">Trajektorie</option>
                                <option value="trajectory-arrows">Trajektorie + ≈°ipky</option>
                                <option value="points">Bodov√Ω graf</option>
                            </select>
                        </div>
                        <button class="maps-section-fullscreen-btn" id="openMapsFullscreen">
                            <span>‚õ∂</span> Cel√° obrazovka
                        </button>
                    </div>
                </div>
                <div class="maps-comparison" style="margin-top: 15px;">
                    <div class="points-legend central-points-legend" id="centralPointsLegend" style="display: none; margin-bottom: 15px; justify-content: flex-start;">
                        <span class="points-legend-title">Legenda:</span>
                        <div class="points-legend-item">
                            <div class="points-legend-square"></div>
                            <span>St√°n√≠ (indigo)</span>
                        </div>
                        <div class="points-legend-item">
                            <div class="points-legend-triangle"></div>
                            <span>Le≈æen√≠ (oran≈æov√°)</span>
                        </div>
                    </div>
                    <h3 style="margin-bottom: 10px;">Den (06:00 ‚Äì 17:59)</h3>
                    <div id="mapsDayGrid" class="map-grid">
                        <!-- Generated dynamically -->
                    </div>
                    <h3 style="margin: 25px 0 10px;">Noc (18:00 ‚Äì 05:59)</h3>
                    <div id="mapsNightGrid" class="map-grid">
                        <!-- Generated dynamically -->
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Maps Fullscreen Overlay -->
    <div class="maps-fullscreen-overlay" id="mapsFullscreenOverlay">
        <div class="maps-fullscreen-header">
            <h3>üó∫Ô∏è Porovn√°n√≠ map - Cel√° obrazovka</h3>
            <div class="maps-fullscreen-controls">
                <label>Obdob√≠:</label>
                <select id="fsMapsPeriod">
                    <option value="day">Den (06:00‚Äì17:59)</option>
                    <option value="night">Noc (18:00‚Äì05:59)</option>
                </select>

                <label>Poƒçet map:</label>
                <select id="fsMapsCount">
                    <option value="2">2 mapy</option>
                    <option value="4">4 mapy</option>
                </select>

                <label>Vrstva:</label>
                <select id="fsMapsLayer">
                    <option value="heat">Heat mapa</option>
                    <option value="trajectory">Trajektorie</option>
                    <option value="trajectory-arrows">Trajektorie + ≈°ipky</option>
                    <option value="points">Bodov√Ω graf</option>
                </select>

                <button class="maps-fullscreen-close" id="closeMapsFullscreen">‚úï Zav≈ô√≠t</button>
            </div>
        </div>
        <div class="maps-fullscreen-body grid-2" id="fsMapsBody">
            <!-- Dynamically generated map cells -->
        </div>
        <div style="padding: 10px 20px; background: rgba(0,0,0,0.3); display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
            <label style="color: var(--text-muted);">Vybran√© dny:</label>
            <div id="fsDaysSelection" style="display: flex; gap: 8px; flex-wrap: wrap;">
                <!-- Day checkboxes generated dynamically -->
            </div>
        </div>
    </div>

    <!-- Shared computational core -->
    <script src="ZONES_RUMBURK.js"></script>
    <script src="Rumburk_analysis_core.js"></script>
    <script src="PregnancyProbabilityCalculator.js"></script>
    <!-- External JavaScript file with enhanced behavior detection and StandBy handling -->
    <script src="ComparativeAnalysis_Rumburk.js"></script>
</body>
</html>
